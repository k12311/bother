<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸­ä¿¡å…„å¼Ÿ APP é¦–é </title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging-compat.js"></script>
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: #fffbe6;
      text-align: center;
      padding: 1.2rem;
    }
    h1 {
      color: #d48806;
    }
    .section {
      background: #fff;
      border: 2px solid #ffd666;
      border-radius: 12px;
      margin: 1.5rem auto;
      padding: 1rem;
      max-width: 520px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
      min-height: 100px;
    }
    .quote {
      font-size: 1.3rem;
      color: #5b3a00;
      margin: 1rem 0;
      min-height: 2.5rem;
    }
    .badge {
      display: inline-block;
      background: #ffd666;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: bold;
      color: #000;
      box-shadow: 0 0 10px rgba(255, 204, 0, 0.6);
      margin: 0.3rem;
    }
    .photo-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .photo-grid img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
      border: 2px solid #ffd666;
    }
    .date-display {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: #8c6d1f;
    }
    #countdownTimer, #reminderInfo, #todayGameInfo, #nextGameInfo {
      font-family: monospace;
      min-height: 1.6rem;
    }
    #fcm-token {
      word-break: break-all;
      color: #999;
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>ğŸ˜ ä¸­ä¿¡å…„å¼Ÿ APP é¦–é </h1>
  <div class="date-display" id="todayDate"></div>

  <div class="section">
    <h2>ğŸ“œ ä»Šæ—¥èªéŒ„</h2>
    <div class="quote" id="dailyQuote">è¼‰å…¥ä¸­...</div>
    <button onclick="challengeQuote()">ğŸ¯ èªéŒ„æŒ‘æˆ°</button>
    <button onclick="toggleFavoriteQuote()">â¤ï¸ æ”¶è—èªéŒ„</button>
  </div>

  <div class="section">
    <h2>ğŸ“£ Firebase æ¨æ’­ Token</h2>
    <div id="fcm-token">å°šæœªè¨»å†Šé€šçŸ¥æ¬Šé™</div>
    <button onclick="requestPushPermission()">ğŸ”” å•Ÿç”¨é€šçŸ¥</button>
  </div>

  <div class="section">
    <h2>ğŸ“† ä»Šå¤©æ¯”è³½ & ä¸‹å ´æ¯”è³½</h2>
    <div id="todayGameInfo"></div>
    <div id="nextGameInfo"></div>
    <div id="countdownTimer"></div>
    <div id="reminderInfo"></div>
  </div>

  <div class="section">
    <h2>â° æé†’è¨­å®š</h2>
    <label>å¹¾åˆ†é˜å‰æé†’ï¼š
      <select id="reminderSelect">
        <option value="5">5 åˆ†</option>
        <option value="15">15 åˆ†</option>
        <option value="30" selected>30 åˆ†</option>
        <option value="60">60 åˆ†</option>
      </select>
    </label>
    <p id="reminderStatus"></p>
  </div>

  <div class="section">
    <h2>ğŸ—“ï¸ æˆ‘æ”¯æŒå…„å¼Ÿç¬¬å¹¾å¤©ï¼Ÿ</h2>
    <div id="fixedDaysResult">è¼‰å…¥ä¸­...</div>
    <div id="specialBadge"></div>
  </div>

  <div class="section">
    <h2>ğŸ… è§£é–å¾½ç« æ¸…å–®</h2>
    <div id="badgeList"></div>
  </div>

  <div class="section">
    <h2>ğŸ“¸ çƒè¿·ç…§ç‰‡ç‰†</h2>
    <div class="photo-grid">
      <img src="https://picsum.photos/seed/a/100" alt="photo1">
      <img src="https://picsum.photos/seed/b/100" alt="photo2">
      <img src="https://picsum.photos/seed/c/100" alt="photo3">
      <img src="https://picsum.photos/seed/d/100" alt="photo4">
    </div>
  </div>

  <div class="section">
    <h2>ğŸ’– æ”¶è—èªéŒ„æ¸…å–®</h2>
    <div id="favoriteQuoteList">å°šç„¡æ”¶è—èªéŒ„</div>
  </div>

<script>
  const quotes = [
    "ä¸æ‹šæ€éº¼æœƒè´ï¼ â€” ç‹å‹å‰",
    "æ¯ä¸€å ´çƒï¼Œéƒ½æ˜¯ä¸€æ¬¡è­‰æ˜è‡ªå·±çš„æ©Ÿæœƒã€‚",
    "å…„å¼Ÿå°±æ˜¯ä¸€è¼©å­çš„ä¿¡ä»°ã€‚",
    "çƒä¾†å°±æ‰“ï¼Œçˆªä¾†å°±ä¸Šï¼",
    "ç›¸ä¿¡éšŠå‹ï¼Œä¹Ÿç›¸ä¿¡è‡ªå·±ã€‚",
    "è¼¸è´æ˜¯éç¨‹ï¼Œæ‹¼ç›¡å…¨åŠ›æ˜¯ä¿¡ä»°ã€‚",
    "ç”¨æ±—æ°´å¯«ä¸‹æ¦®è€€çš„åå­—ã€‚",
    "ä¸æ˜¯æœ€å¼·ï¼Œä½†æœ€åœ˜çµã€‚",
    "è·Œå€’æ²’é—œä¿‚ï¼Œç«™èµ·ä¾†å†æ‹¼å°±å°äº†ã€‚",
    "è®“æˆ‘å€‘ä¸€èµ·æŠŠä¸»å ´å®ˆä½ï¼"
  ];

  const gameList = [
  { date: "2025-05-02", time: "18:35", opponent: "å°é‹¼é›„é·¹", location: "å˜‰ç¾©å¸‚", home: false },
  { date: "2025-05-03", time: "18:35", opponent: "å°é‹¼é›„é·¹", location: "æ¾„æ¸…æ¹–", home: false },
  { date: "2025-05-04", time: "16:05", opponent: "å°é‹¼é›„é·¹", location: "æ¾„æ¸…æ¹–", home: false },
  { date: "2025-05-06", time: "18:35", opponent: "çµ±ä¸€ç…", location: "æ´²éš›", home: true },
  { date: "2025-05-07", time: "18:35", opponent: "çµ±ä¸€ç…", location: "æ´²éš›", home: true },
  { date: "2025-05-09", time: "18:35", opponent: "å°é‹¼é›„é·¹", location: "æ´²éš›", home: true },
  { date: "2025-05-10", time: "17:05", opponent: "å°é‹¼é›„é·¹", location: "æ´²éš›", home: true },
  { date: "2025-05-11", time: "17:05", opponent: "å°é‹¼é›„é·¹", location: "æ´²éš›", home: true },
  { date: "2025-05-13", time: "18:35", opponent: "å‘³å…¨é¾", location: "å¤©æ¯", home: true },
  { date: "2025-05-14", time: "18:35", opponent: "å‘³å…¨é¾", location: "å¤©æ¯", home: true },
  { date: "2025-05-16", time: "18:35", opponent: "æ¨‚å¤©æ¡ƒçŒ¿", location: "æ´²éš›", home: true },
  { date: "2025-05-17", time: "17:05", opponent: "æ¨‚å¤©æ¡ƒçŒ¿", location: "æ´²éš›", home: true },
  { date: "2025-05-18", time: "17:05", opponent: "æ¨‚å¤©æ¡ƒçŒ¿", location: "æ´²éš›", home: true },
  { date: "2025-05-21", time: "18:35", opponent: "å¯Œé‚¦æ‚å°‡", location: "æ´²éš›", home: true },
  { date: "2025-05-22", time: "18:35", opponent: "çµ±ä¸€ç…", location: "å°å—", home: false },
  { date: "2025-05-23", time: "18:35", opponent: "çµ±ä¸€ç…", location: "å°å—", home: false },
  { date: "2025-05-24", time: "17:05", opponent: "çµ±ä¸€ç…", location: "å°å—", home: false },
  { date: "2025-05-25", time: "17:05", opponent: "çµ±ä¸€ç…", location: "å°å—", home: false }
];

  function formatMatchup(game) {
    return game.home
      ? `ä¸­ä¿¡å…„å¼Ÿ vs ${game.opponent}ï¼ˆ${game.location}ï¼‰`
      : `ä¸­ä¿¡å…„å¼Ÿ @ ${game.opponent}ï¼ˆ${game.location}ï¼‰`;
  }

  function getGameStyle(game) {
    const isHome = game.home;
    const emoji = isHome ? "ğŸ " : "ğŸšŒ";
    const bg = isHome ? "#fff4cc" : "#f0f0f0";
    const color = isHome ? "#000" : "#555";
    const text = `${emoji} ${formatMatchup(game)}`;
    return `<span style="
      display: inline-block;
      background: ${bg};
      color: ${color};
      padding: 6px 12px;
      border-radius: 16px;
      font-weight: bold;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.05);
      margin-top: 6px;">
      ${text}
    </span>`;
  }

  function loadGameInfo() {
    const today = new Date();
    const todayStr = today.toISOString().split("T")[0];
    const now = new Date();

    document.getElementById("todayDate").innerText = `ğŸ“… ä»Šå¤©æ˜¯ ${today.getFullYear()} å¹´ ${today.getMonth() + 1} æœˆ ${today.getDate()} æ—¥`;

    const todayGame = gameList.find(g => g.date === todayStr);
    const nextGame = gameList.find(g => {
      const gameTime = new Date(`${g.date}T${g.time}`);
      return gameTime > now && g.date !== todayStr;
    });

    const todayEl = document.getElementById("todayGameInfo");
    const nextEl = document.getElementById("nextGameInfo");
    const countdownEl = document.getElementById("countdownTimer");
    const reminderEl = document.getElementById("reminderInfo");

    todayEl.innerHTML = todayGame
      ? `ğŸ“ <b>ä»Šå¤©æœ‰æ¯”è³½</b>ï¼š${todayGame.date} ${todayGame.time}<br>${getGameStyle(todayGame)}`
      : "ğŸ“ ä»Šå¤©ç„¡æ¯”è³½";

    if (nextGame) {
      const targetTime = new Date(`${nextGame.date}T${nextGame.time}+08:00`);
      const diff = targetTime - now;
      const minutes = Math.floor(diff / (1000 * 60));
      const h = Math.floor(diff / (1000 * 60 * 60));
      const m = Math.floor((diff / (1000 * 60)) % 60);
      const s = Math.floor((diff / 1000) % 60);

      nextEl.innerHTML = `<hr style='border:none; border-top:1px dashed #ccc; margin: 1em 0;'>
        â­ï¸ <b>ä¸‹å ´æ¯”è³½</b>ï¼š${nextGame.date} ${nextGame.time}<br>${getGameStyle(nextGame)}`;

      countdownEl.innerText = `â³ ${h.toString().padStart(2, '0')}æ™‚ ${m.toString().padStart(2, '0')}åˆ† ${s.toString().padStart(2, '0')}ç§’`;
      reminderEl.innerText = `â° è·é›¢é–‹æ‰“ï¼š${minutes} åˆ†é˜`;

      const userSetMinutes = parseInt(localStorage.getItem("reminderMinutes") || "30");
      if (minutes === userSetMinutes && Notification.permission === "granted" && !window.notified) {
        new Notification("ğŸ˜ æ¯”è³½æé†’", {
          body: `è·é›¢æ¯”è³½åªå‰© ${userSetMinutes} åˆ†é˜ï¼${formatMatchup(nextGame)}`,
          icon: "https://upload.wikimedia.org/wikipedia/zh/1/13/Chinatrust_Brothers_Logo.png"
        });
        window.notified = true;
      }
      if (minutes > userSetMinutes) window.notified = false;
    } else {
      nextEl.innerHTML = "â­ï¸ ç„¡ä¸‹å ´æ¯”è³½";
      countdownEl.innerText = "";
      reminderEl.innerText = "";
    }
  }

  function getTodayQuote() {
    const today = new Date();
    const index = today.getDate() % quotes.length;
    const quote = quotes[index];
    document.getElementById("dailyQuote").innerText = quote;
    localStorage.setItem("currentQuoteIndex", index);
  }

  function toggleFavoriteQuote() {
    const index = localStorage.getItem("currentQuoteIndex");
    let favs = JSON.parse(localStorage.getItem("favoriteQuotes") || "[]");
    if (favs.includes(index)) {
      favs = favs.filter(i => i !== index);
    } else {
      favs.push(index);
    }
    localStorage.setItem("favoriteQuotes", JSON.stringify(favs));
    if (favs.length >= 5) addBadge("â­ èªéŒ„æ”¶è—é”äººç« ");
    renderFavoriteQuotes();
  }

  function renderFavoriteQuotes() {
    const favs = JSON.parse(localStorage.getItem("favoriteQuotes") || "[]");
    const box = document.getElementById("favoriteQuoteList");
    if (favs.length === 0) {
      box.innerText = "å°šç„¡æ”¶è—èªéŒ„";
      return;
    }
    box.innerHTML = favs.map(i => `<div>ğŸ’¬ ${quotes[i]}</div>`).join('');
  }

  function challengeQuote() {
    let count = parseInt(localStorage.getItem("quoteChallenges") || "0") + 1;
    localStorage.setItem("quoteChallenges", count);
    if (count >= 10) addBadge("ğŸ§  èªéŒ„æŒ‘æˆ°é”æˆç« ");
    alert(`ä½ å·²å®ŒæˆèªéŒ„æŒ‘æˆ° ${count} æ¬¡ï¼`);
  }

  function showSupportDays() {
    const startDate = new Date("2024-11-24");
    const today = new Date();
    const diffTime = today - startDate;
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
    document.getElementById("fixedDaysResult").innerText = `ä½ æ”¯æŒå…„å¼Ÿå·²ç¶“ç¬¬ ${diffDays} å¤©å•¦ ğŸ’›`;
  }

  function addBadge(name) {
    const badgeBox = document.getElementById("badgeList");
    if (!badgeBox.innerHTML.includes(name)) {
      badgeBox.innerHTML += `<div class="badge">${name}</div>`;
    }
  }

  const reminderSelect = document.getElementById("reminderSelect");
  const reminderStatus = document.getElementById("reminderStatus");
  reminderSelect.addEventListener("change", () => {
    const selected = reminderSelect.value;
    localStorage.setItem("reminderMinutes", selected);
    reminderStatus.innerText = `âœ… å·²è¨­å®šæé†’ç‚ºæ¯”è³½å‰ ${selected} åˆ†é˜`;
  });
  const savedReminder = localStorage.getItem("reminderMinutes") || "30";
  reminderSelect.value = savedReminder;
  reminderStatus.innerText = `âœ… å·²è¨­å®šæé†’ç‚ºæ¯”è³½å‰ ${savedReminder} åˆ†é˜`;

  const firebaseConfig = {
    apiKey: "AIzaSyB4DjxxWFZvaN54loy0fzo010sxslXfMeg",
    authDomain: "ffjj-67dcf.firebaseapp.com",
    projectId: "ffjj-67dcf",
    storageBucket: "ffjj-67dcf.appspot.com",
    messagingSenderId: "572382978762",
    appId: "1:572382978762:web:83302fb8bcbee65be5ca33"
  };
  firebase.initializeApp(firebaseConfig);
  const messaging = firebase.messaging();
  navigator.serviceWorker.register("firebase-messaging-sw.js").then(reg => {
    messaging.useServiceWorker(reg);
    messaging.requestPermission()
      .then(() => messaging.getToken({ vapidKey: "BF2_h3WIsDKtuLq6vGuIoLrpqsJwArlcYnMWAxelIA12E6Od8bu2vdKXF9EppAj4MER3LXUE6oZnEGB7nrXSYnI" }))
      .then(token => document.getElementById("fcm-token").innerText = token)
      .catch(() => document.getElementById("fcm-token").innerText = "âŒ ç„¡æ³•å–å¾—é€šçŸ¥æ¬Šé™");
  });

  getTodayQuote();
  loadGameInfo();
  setInterval(loadGameInfo, 1000);
  showSupportDays();
  renderFavoriteQuotes();
</script>
</body>
</html>




